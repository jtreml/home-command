<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="hue-light">

  <style>
    :host {
      display: block;
      box-sizing: border-box;
    }
  </style>

  <template>
    <svg id="svg" viewBox="0 0 369 475" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" style="width: 100%; height: 100%;">
        <!-- Generator: Sketch 3.4.2 (15855) - http://www.bohemiancoding.com/sketch -->
        <title>hue-a19</title>
        <desc>Created with Sketch.</desc>
        <defs>
            <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-1">
                <feGaussianBlur stdDeviation="24.5605469" in="SourceGraphic" result="blur"></feGaussianBlur>
            </filter>
            <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-2">
                <feGaussianBlur stdDeviation="0" in="SourceGraphic" result="blur"></feGaussianBlur>
            </filter>
            <filter x="-50%" y="-50%" width="200%" height="200%" filterUnits="objectBoundingBox" id="filter-3">
                <feGaussianBlur stdDeviation="21.1081112" in="SourceGraphic" result="blur"></feGaussianBlur>
            </filter>
        </defs>
        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
            <g id="hue-a19" sketch:type="MSLayerGroup" transform="translate(50.000000, 45.000000)">
                <path d="M252.605253,71.7153177 C257.408604,60.5870343 259.033163,46.149902 232.849328,36.2582669 C210.009051,27.6211239 162.77326,23.0934704 134.469562,23.4751712 C106.118643,23.0934704 58.8838575,27.6211239 36.0425758,36.2582669 C9.85874106,46.149902 11.459188,60.5870343 16.2625383,71.7153177 C30.1551815,102.626871 42.446373,119.100517 42.446373,119.100517 L226.444526,119.100517 C226.444526,119.100517 238.735718,102.626871 252.605253,71.7153177 Z" id="bulb-fill" opacity="0.79920709" fill="#F72D1C" filter="url(#filter-1)" sketch:type="MSShapeGroup"></path>
                <path d="M253.05541,70.2087505 C257.83641,55.8647505 259.45341,37.2557505 233.39141,24.5057505 C210.65741,13.3727505 163.64141,7.53675049 135.46941,8.02875049 C107.25041,7.53675049 60.2354102,13.3727505 37.5004102,24.5057505 C11.4384102,37.2557505 13.0314102,55.8647505 17.8124102,70.2087505 C31.6404102,110.05275 43.8744102,131.28675 43.8744102,131.28675 L227.01641,131.28675 C227.01641,131.28675 239.25041,110.05275 253.05541,70.2087505 Z" id="bulb-outline" stroke="#000000" stroke-width="4.8" filter="url(#filter-2)" sketch:type="MSShapeGroup"></path>
                <path d="M267.365759,70.2775383 C272.728452,54.1883386 274.542188,33.3152267 245.309288,19.0139651 C219.809297,6.52644002 167.072975,-0.0196119502 135.473356,0.532248497 C103.821018,-0.0196119502 51.0858174,6.52644002 25.5847051,19.0139651 C-3.64819525,33.3152267 -1.8613788,54.1883386 3.50131388,70.2775383 C19.0117331,114.969261 32.7342142,138.78675 32.7342142,138.78675 L238.158657,138.78675 C238.158657,138.78675 251.881138,114.969261 267.365759,70.2775383 Z" id="bulb-glow" opacity="0" fill="#F72D1C" filter="url(#filter-3)" sketch:type="MSShapeGroup"></path>
                <path d="M86,333 L86,396.211 C86,403.641 97.672,408.984 106.695,411.094 C108.289,414.282 113.093,419.602 118.39,425.438 C125.515,427.829 144.594,427.829 151.719,425.438 C157.016,419.602 161.797,414.282 163.391,411.094 C172.438,408.985 184.133,403.641 184.133,396.211 L184.133,333 L86,333 Z" id="socket" stroke="#000000" stroke-width="4.8" fill="#EDEDE6" sketch:type="MSShapeGroup"></path>
                <path d="M188.6737,347.84483 L132.8457,352.64983 L132.3527,352.67283 L79.9937,357.17283" id="thread-1" stroke="#000000" stroke-width="4.8" stroke-linecap="round" stroke-linejoin="round" sketch:type="MSShapeGroup"></path>
                <path d="M189.4477,363.71183 L133.6657,368.49383 L133.1737,368.56383 L80.8137,373.04083" id="thread-2" stroke="#000000" stroke-width="4.8" stroke-linecap="round" stroke-linejoin="round" sketch:type="MSShapeGroup"></path>
                <path d="M188.6737,379.57983 L132.8457,384.36083 L132.3527,384.40783 L79.9937,388.90783" id="thread-3" stroke="#000000" stroke-width="4.8" stroke-linecap="round" stroke-linejoin="round" sketch:type="MSShapeGroup"></path>
                <path d="M44.3127,131.74483 C74.0787,224.74783 71.9457,315.59583 71.9457,315.59583 L86.8287,332.61183 L184.9617,332.61183 L199.8447,315.59583 C199.8457,315.59483 197.6897,224.74783 227.4547,131.74483 L44.3127,131.74483 Z" id="body" stroke="#000000" stroke-width="4.8" fill="#F1F1F1" sketch:type="MSShapeGroup"></path>
            </g>
        </g>
    </svg>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'hue-light',

        properties: {
          hue: Number,
          saturation: Number,
          brightness: Number,
          on: {
            type: Boolean,
            value: false
          },
          reachable: {
            type: Boolean,
            value: false
          }
        },

        observers: [
          '_hueChanged(hue)',
          '_saturationChanged(saturation)',
          '_brightnessChanged(brightness)',
          '_onChanged(on)',
          '_reachableChanged(reachable)'
        ],

        _hueChanged: function(hue) {
          this._updateColor()
        },

        _saturationChanged: function(saturation) {
          this._updateColor()
        },

        _brightnessChanged: function(brightness) {
          this._updateColor()
        },

        _onChanged: function(on) {
          this._updateColor()
        },

        _reachableChanged: function(reachable) {
          this._updateColor()
        },

        _updateColor: function() {
          // hue < 0.1 -> hue = 0.1, brightness = 0.8
          var rgb
          if(isNaN(this.hue) || this.saturation < 0.07)
            rgb = { r: 225, g: 225, b: 225 }
          else
            rgb = this._hsvToRgb(this.hue, this.saturation, 1)

          var color = 'rgb(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ')'

          var svgDoc = this.$.svg

          var fill = svgDoc.getElementById("bulb-fill")
          // Workaround because the above line doesn't work in Safari
          if(!fill) fill = this._findNode(svgDoc.children, "bulb-fill", this._findNode)
          fill.setAttributeNS(null, 'fill', color)
          fill.setAttributeNS(null, 'visibility', this.on ? 'visible' : 'hidden')

          var glow = svgDoc.getElementById("bulb-glow")
          // Workaround because the above line doesn't work in Safari
          if(!glow) glow = this._findNode(svgDoc.children, "bulb-glow", this._findNode)
          glow.setAttributeNS(null, 'fill', color)
          glow.setAttributeNS(null, 'opacity', this.brightness)
          glow.setAttributeNS(null, 'visibility', this.on ? 'visible' : 'hidden')

          this.$.svg.style.opacity = this.reachable ? 1.0 : 0.3
        },

        ready: function() {
        },

        attached: function() {
        },

        detached: function() {
        },

        setColor: function(color) {
          this.set('color', color)
        },

        _hsvToRgb: function(h, s, v) {
          var r, g, b, i, f, p, q, t
          if (arguments.length === 1) {
              s = h.s, v = h.v, h = h.h
          }
          i = Math.floor(h * 6)
          f = h * 6 - i
          p = v * (1 - s)
          q = v * (1 - f * s)
          t = v * (1 - (1 - f) * s)
          switch (i % 6) {
              case 0: r = v, g = t, b = p; break
              case 1: r = q, g = v, b = p; break
              case 2: r = p, g = v, b = t; break
              case 3: r = p, g = q, b = v; break
              case 4: r = t, g = p, b = v; break
              case 5: r = v, g = p, b = q; break
          }
          return {
              r: Math.round(r * 255),
              g: Math.round(g * 255),
              b: Math.round(b * 255)
          }
        },

        _findNode: function(nodes, id, self) {
          for(var i = 0; i < nodes.length; i++) {
            var node = nodes[i]
            if(node.attributes.id && node.attributes.id.value == id)
              return node
            node = self(node.children, id, self)
            if(node)
              return node
          }
          return undefined
        }
      });
    })();
  </script>

</dom-module>
